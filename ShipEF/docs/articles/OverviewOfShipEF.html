<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of ShipEF • ShipEF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of ShipEF">
<meta property="og:description" content="ShipEF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ShipEF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/OverviewOfShipEF.html">Overview of ShipEF</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="OverviewOfShipEF_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview of ShipEF</h1>
            
      
      
      <div class="hidden name"><code>OverviewOfShipEF.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The ShipEF package provides functions for assigning emission factors to commercial marine vessels (CMV). For various pollutants, emission factors depend on vessel characteristics, vessel operating modes, and/or vessel location.</p>
<p>This example demonstrates how to use the ShipEF package in conjunction with ship power estimates and activity data to calculate applicable emission factors. It also includes the calculation of emission quantities using the emission factors and the example activity data.</p>
<p>Since the ShipEF calculations use ship power estimates and activity data as inputs, the following subsections briefly describe useful data sources and then provide sample data which will be used in the rest of this example.</p>
<div id="vessel-characteristics-data" class="section level3">
<h3 class="hasAnchor">
<a href="#vessel-characteristics-data" class="anchor"></a>Vessel Characteristics Data</h3>
<p>Vessel characteristics data are needed to calculate the appropriate emission factor for a given ship. For example, nitrogen oxides (NOx) emission factors depend in part on when a ship’s keel was laid and what kind of engine it has.</p>
<p>Vessel characteristics data include the following fields:</p>
<ul>
<li>Vessel identification fields:
<ul>
<li>International Maritime Organization (IMO) number</li>
<li>Maritime Mobile Service Identity (MMSI)</li>
</ul>
</li>
<li>Engine characteristics fields:
<ul>
<li>Engine bore (the diameter of each engine cylinder, mm)</li>
<li>Engine stroke (the stroke length of each engine cylinder, mm)</li>
<li>Engine type (typically slow- or medium-speed diesel, among others)</li>
<li>Engine speed (revolutions per minute [rpm])</li>
<li>Keel-laid year (used to determine engine tier)</li>
</ul>
</li>
<li>Ship type and capacity fields:
<ul>
<li>Ship type</li>
<li>Deadweight tonnage (DWT)</li>
<li>Twenty-foot equivalent units (TEU)</li>
<li>Gross tonnage</li>
</ul>
</li>
<li>Engine operating power fields:
<ul>
<li>Maximum draft (m)</li>
<li>Service speed (kn)</li>
<li>Total installed propulsion power (also known as maximum continuous rated engine power, measured in kW)</li>
</ul>
</li>
</ul>
<p>The vessel identification fields are used to merge vessel characteristics data with vessel activity data. The engine characteristics fields are used when calculating emission factors. The engine operating power fields are used when calculating load factors, the importance of which is described in the next section. The ship type and capacity fields are not directly used by this package, but they are typically present in vessel characteristics datasets and are useful for other calculations (e.g., engine loads), and therefore are included here for completeness.</p>
<p>Vessel characteristics data may be available for purchase in the form of vessel registry databases. EPA does not endorse or promote any specific vendor of this information. Note that port records, vessel surveys, federal databases, and online searches can supplement and validate these data. For more information regarding vessel characteristics data, see Section 3.3 of the Port Emissions Inventory Guidance.</p>
<p>We will now create a sample of ship registry data for four hypothetical vessels:</p>
<pre><code>#&gt;    IMO MMSI mainEngineBore mainEngineStroke                propulsionType
#&gt; 1:   1   10            320              440   Oil Engine(s), Direct Drive
#&gt; 2:   2   11            500             2000 Oil Engine(s), Electric Drive
#&gt; 3:   3   12            420             1764  Steam Recip(s), Direct Drive
#&gt; 4:   4   13            400              460  Gas Turbine(s), Geared Drive
#&gt;    mainEngineStrokeType mainEngineRPM keelLaidYear              Vessel_Type
#&gt; 1:                    4           450         1999          Ore/Oil Carrier
#&gt; 2:                    2            NA         2003 Fully Cellular Container
#&gt; 3:                   NA           350         2017         Pure Car Carrier
#&gt; 4:                   NA           650         2014              Cruise Ship
#&gt;       DWT  TEU GrossTonnage MaxDraft Service_Speed Propulsive_Power
#&gt; 1: 319869   NA    156168.00    22.28          15.9            31640
#&gt; 2:  41500 3139           NA    12.00          22.7            31990
#&gt; 3:  21052   NA     52337.00    10.00          20.5            15820
#&gt; 4:     NA   NA     30780.79     7.52          21.0            22705</code></pre>
</div>
<div id="ship-activity-data" class="section level3">
<h3 class="hasAnchor">
<a href="#ship-activity-data" class="anchor"></a>Ship Activity Data</h3>
<p>Ship activity data are also needed to calculate the appropriate emission factor for a given ship.</p>
<p>One reason for this is that the location of the vessel is used to determine whether the vessel is inside or outside the North American Emissions Control Area (ECA), which in turn determines the fuel sulfur content.</p>
<p>Another use of the ship activity data is to calculate load factor. Load factor is important when calculating emission factors because diesel engines are less efficient at low loads, and emissions per unit of energy tend to increase as the engine load decreases. To account for this, low load adjustment factors are applied when the propulsion engines are operating at less than 20% load. These adjustment factors are applied by default in <code>calcEF</code>. However, if engine-specific load adjustment factors are available for vessels with known engine data, they may be used instead by supplying them as an optional argument, as described later in this vignette.</p>
<p>A common source of ship activity data is Automatic Identification System (AIS) data. AIS equipment is used on vessels to aid navigation and to avoid collisions by broadcasting and receiving messages. These messages contain dynamic operational data, which are automatically updated with every message and include the following fields:</p>
<ul>
<li>Position (latitude and longitude coordinates)</li>
<li>Bearing</li>
<li>Speed</li>
<li>Timestamp</li>
</ul>
<p>AIS data also contain static fields, which may be manually entered by the vessel operator. The static fields include (among others):</p>
<ul>
<li>International Maritime Organization (IMO) number</li>
<li>Maritime Mobile Service Identity (MMSI)</li>
<li>Draft</li>
</ul>
<p>The IMO and MMSI fields can be used to merge AIS data with vessel characteristics data. The combined dataset can be used to determine load factor, and the latitude and longitude coordinates can be used to determine whether or not the vessel is inside or outside the ECA.</p>
<p>For more background information on AIS data and other vessel activity data sources, see Section 3.4 of the Port Emissions Inventory Guidance.</p>
<p>We will now create a sample of hypothetical AIS data. For simplicity, we will assign the same activity to each of the four vessels (i.e., same lat/long coordinates and timestamps).</p>
<pre><code>#&gt;    IMO MMSI TimeBtwnMsgs_hr longitude latitude ShipSpeed_kn cog_deg draft ECA
#&gt; 1:   1   NA        0.000000 -149.8909 61.24134            0     360 11.14 ECA
#&gt; 2:   1   NA        0.333333 -150.4688 61.14324            7     190 10.80 ECA
#&gt; 3:   1   NA        0.333333 -151.6003 60.74306           15     180  7.50 ECA
#&gt; 4:   1   NA        0.333333 -152.0288 60.11415           15     175  5.64 ECA
#&gt; 5:   1   NA        0.333333 -151.8166 59.59380           19     167 11.14 ECA
#&gt; 6:   1   NA        0.333333 -151.4129 59.60492            3      90 10.80 ECA</code></pre>
</div>
<div id="ship-registry-calculations" class="section level3">
<h3 class="hasAnchor">
<a href="#ship-registry-calculations" class="anchor"></a>Ship Registry Calculations</h3>
<p>The emission factor calculations depend on some vessel characteristics data that are not directly in ship registry data. Therefore, this package contains ship registry calculations that derive the needed characteristics.</p>
<p>In this example, we do all the ship registry calculation functions first before we merge the vessel characteristics with the activity dataset. We begin by determining the engine category. In this case all vessels are Category 3 (C3) since this package is currently set up for C3 vessels.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shipRegistry</span><span class="op">[</span>, <span class="va">Category</span><span class="op">:=</span><span class="fu"><a href="../reference/calcShipCategory.html">calcShipCategory</a></span><span class="op">(</span>mainEngineBore <span class="op">=</span> <span class="va">mainEngineBore</span>,
                                          mainEngineStroke <span class="op">=</span> <span class="va">mainEngineStroke</span><span class="op">)</span><span class="op">]</span>
<span class="va">shipRegistry</span><span class="op">$</span><span class="va">Category</span>
<span class="co">#&gt; [1] 3 3 3 3</span></code></pre></div>
<p>Next we calculate propulsion engine type (e.g., SSD or MSD). This function uses propulsion type, main engine stroke type (2 vs 4), and engine rpm to determine between SSD, MSD, and other engine types. It also handles missing data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shipRegistry</span><span class="op">[</span>,<span class="va">mainEngineType</span><span class="op">:=</span><span class="fu"><a href="../reference/calcEngineType.html">calcEngineType</a></span><span class="op">(</span>propulsionType <span class="op">=</span> <span class="va">propulsionType</span>,
                                         mainEngineStrokeType <span class="op">=</span> <span class="va">mainEngineStrokeType</span>,
                                         mainEngineRPM <span class="op">=</span> <span class="va">mainEngineRPM</span>,
                                         main_aux_boiler <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span><span class="op">]</span>
<span class="va">shipRegistry</span><span class="op">$</span><span class="va">mainEngineType</span>
<span class="co">#&gt; [1] "MSD" "SSD" "ST"  "GT"</span></code></pre></div>
<p>We also can calculate auxiliary engine type (e.g., MSD or HSD) using the same <code>calcEngineType</code> function by specifying <code>main_aux_boiler = "aux"</code>, and boiler engine type (i.e., “Boiler”) by specifying <code>main_aux_boiler="boiler"</code>. Note that the <code>mainEngineStrokeType</code> and <code>mainEngineRPM</code> arguments are not needed for auxiliary or boiler engines.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shipRegistry</span><span class="op">[</span>, <span class="va">auxEngineType</span> <span class="op">:=</span> <span class="fu"><a href="../reference/calcEngineType.html">calcEngineType</a></span><span class="op">(</span>propulsionType <span class="op">=</span> <span class="va">propulsionType</span>,
                                               main_aux_boiler <span class="op">=</span> <span class="st">"aux"</span><span class="op">)</span><span class="op">]</span>
<span class="va">shipRegistry</span><span class="op">$</span><span class="va">auxEngineType</span>
<span class="co">#&gt; [1] "MSD" "MSD" "MSD" "MSD"</span>

<span class="va">shipRegistry</span><span class="op">[</span>, <span class="va">boilerEngineType</span> <span class="op">:=</span> <span class="fu"><a href="../reference/calcEngineType.html">calcEngineType</a></span><span class="op">(</span>propulsionType <span class="op">=</span> <span class="va">propulsionType</span>,
                                                  main_aux_boiler <span class="op">=</span> <span class="st">"boiler"</span><span class="op">)</span><span class="op">]</span>
<span class="va">shipRegistry</span><span class="op">$</span><span class="va">boilerEngineType</span>
<span class="co">#&gt; [1] "Boiler" "Boiler" "Boiler" "Boiler"</span></code></pre></div>
<p>Once we’ve calculated ship category and engine type, we can calculate engine tier. Engine tier is based on keel laid year and is important for calculating the correct NOx emission factors. For simplicity, gas turbine (GT), steam turbine (ST), LNG and all non-C3 engines are labeled “Tier 0” in this package since they are not covered by the C3 NOx regulations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shipRegistry</span><span class="op">[</span>,<span class="va">tier</span><span class="op">:=</span><span class="fu"><a href="../reference/calcTier.html">calcTier</a></span><span class="op">(</span>engineType <span class="op">=</span> <span class="va">mainEngineType</span>,
                             keelLaidYear <span class="op">=</span> <span class="va">keelLaidYear</span>,
                             shipCategory <span class="op">=</span> <span class="va">Category</span><span class="op">)</span><span class="op">]</span>
<span class="va">shipRegistry</span><span class="op">$</span><span class="va">tier</span>
<span class="co">#&gt; [1] Tier 0 Tier 1 Tier 0 Tier 0</span>
<span class="co">#&gt; Levels: Tier 0 Tier 1</span></code></pre></div>
</div>
<div id="merging-vessel-characteristics-and-ais" class="section level3">
<h3 class="hasAnchor">
<a href="#merging-vessel-characteristics-and-ais" class="anchor"></a>Merging Vessel Characteristics and AIS</h3>
<p>Now that the vessel parameters have been calculated, the ship registry and AIS activity datasets can be merged so that engine load can be calculated. To simulate real AIS data handling issues, some of our AIS data matches our ship registry data by IMO Number, while the remaining will have to match AIS data to the ship registry data by Maritime Mobile Service Number (MMSI).</p>
<p>The IMO Number matching is a preferred method since this number is given to the ship when its keel is laid and stays with the vessel for its entire life. The MMSI number is attached to the radio transmitter of the vessel and it is possible for the MMSI number to change for a vessel if the transmitter changes.</p>
<p>To handle the merge, we will create a <code>VesselID</code> field in both tables that will contain the IMO Number if available, and the MMSI otherwise. Then we merge using the <code>VesselID</code> field.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Assign VesselID for AIS Sample</span>
<span class="va">AIS_Sample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">AIS_Sample</span><span class="op">$</span><span class="va">MMSI</span> <span class="op">%in%</span> <span class="va">shipRegistry</span><span class="op">$</span><span class="va">MMSI</span><span class="op">)</span>, <span class="va">VesselID</span><span class="op">:=</span><span class="va">MMSI</span><span class="op">]</span>
<span class="va">AIS_Sample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">AIS_Sample</span><span class="op">$</span><span class="va">IMO</span> <span class="op">%in%</span> <span class="va">shipRegistry</span><span class="op">$</span><span class="va">IMO</span><span class="op">)</span>, <span class="va">VesselID</span><span class="op">:=</span><span class="va">IMO</span><span class="op">]</span>

<span class="co">#Assign VesselID for shipRegistry</span>
<span class="va">shipRegistry</span> <span class="op">&lt;-</span> <span class="va">shipRegistry</span><span class="op">[</span><span class="va">MMSI</span><span class="op">%in%</span><span class="va">AIS_Sample</span><span class="op">$</span><span class="va">VesselID</span>, <span class="va">VesselID</span><span class="op">:=</span><span class="va">MMSI</span><span class="op">]</span>
<span class="va">shipRegistry</span> <span class="op">&lt;-</span> <span class="va">shipRegistry</span><span class="op">[</span><span class="va">IMO</span><span class="op">%in%</span><span class="va">AIS_Sample</span><span class="op">$</span><span class="va">VesselID</span>, <span class="va">VesselID</span><span class="op">:=</span><span class="va">IMO</span><span class="op">]</span>

<span class="co">#Merge AIS_Sample with ship registry for those that are non-NA Vessel ID</span>
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">shipRegistry</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">VesselID</span><span class="op">)</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">shipRegistry</span><span class="op">)</span><span class="op">%in%</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IMO"</span>,<span class="st">"MMSI"</span><span class="op">)</span>,with<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">[</span><span class="va">AIS_Sample</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">VesselID</span><span class="op">)</span><span class="op">==</span><span class="cn">FALSE</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">shipRegistry</span><span class="op">)</span><span class="op">%in%</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IMO"</span>,<span class="st">"MMSI"</span><span class="op">)</span>,with<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, on<span class="op">=</span><span class="st">"VesselID"</span><span class="op">]</span></code></pre></div>
</div>
<div id="engine-load-and-load-factors" class="section level3">
<h3 class="hasAnchor">
<a href="#engine-load-and-load-factors" class="anchor"></a>Engine Load and Load Factors</h3>
<p>Now that ship registry and AIS activity data have been combined, we can calculate engine load. EPA has a separate package for this, <code>ShipPowerModel</code>. For the purposes of this vignette, the main engine loads were calculated using <code><a href="https://rdrr.io/pkg/ShipPowerModel/man/calcAdmPwr.html">ShipPowerModel::calcAdmPwr()</a></code>, and saved in the <code>mainLoad</code> variable defined below. The auxiliary and boiler loads were calculated using <code><a href="https://rdrr.io/pkg/ShipPowerModel/man/calcAuxBoilerLoad.html">ShipPowerModel::calcAuxBoilerLoad()</a></code> and saved into <code>auxLoad</code> and <code>boilerLoad</code>, respectively.</p>
<p>Load factor is calculated by dividing the instantaneous main engine load by the installed propulsive power.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mainLoad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0000</span>,<span class="fl">1591.3279</span>,<span class="fl">12279.0377</span>,<span class="fl">10154.1340</span>,<span class="fl">31640.0000</span>,<span class="fl">632.8000</span>,
              <span class="fl">24954.6428</span>,<span class="fl">24069.0585</span>,<span class="fl">1023.0423</span>,<span class="fl">31640.0000</span>,<span class="fl">9983.3124</span>,<span class="fl">6609.9652</span>,
              <span class="fl">8184.3384</span>,<span class="fl">12730.6230</span>,<span class="fl">0.0000</span>,<span class="fl">1576.1479</span>,<span class="fl">24414.4723</span>,<span class="fl">23915.1468</span>,
              <span class="fl">31990.0000</span>,<span class="fl">639.8000</span>,<span class="fl">31990.0000</span>,<span class="fl">31990.0000</span>,<span class="fl">1200.2675</span>,<span class="fl">31990.0000</span>,
              <span class="fl">19849.8702</span>,<span class="fl">15567.8748</span>,<span class="fl">9602.1397</span>,<span class="fl">12609.1830</span>,<span class="fl">0.0000</span>,<span class="fl">1357.2915</span>,
              <span class="fl">10473.1613</span>,<span class="fl">8660.7670</span>,<span class="fl">15820.0000</span>,<span class="fl">316.4000</span>,<span class="fl">15820.0000</span>,<span class="fl">15820.0000</span>,
              <span class="fl">872.5836</span>,<span class="fl">15820.0000</span>,<span class="fl">8515.0681</span>,<span class="fl">5637.8385</span>,<span class="fl">6980.6689</span>,<span class="fl">10858.3320</span>,
              <span class="fl">0.0000</span>,<span class="fl">1527.6124</span>,<span class="fl">22705.0000</span>,<span class="fl">22705.0000</span>,<span class="fl">22705.0000</span>,<span class="fl">454.1000</span>,
              <span class="fl">22705.0000</span>,<span class="fl">22705.0000</span>,<span class="fl">1163.3067</span>,<span class="fl">22705.0000</span>,<span class="fl">19238.6182</span>,<span class="fl">15088.4815</span>,
              <span class="fl">9306.4537</span>,<span class="fl">12220.8989</span><span class="op">)</span>

<span class="va">auxLoad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">970</span>,<span class="fl">730</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">730</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">490</span>,<span class="fl">940</span>,<span class="fl">2470</span>,
             <span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">2470</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1390</span>,<span class="fl">1200</span>,
             <span class="fl">2720</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">2720</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">950</span>,<span class="fl">3500</span>,<span class="fl">5460</span>,
             <span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">5460</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span>,<span class="fl">3500</span><span class="op">)</span>

<span class="va">boilerLoad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">450</span>,<span class="fl">450</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">450</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">450</span>,<span class="fl">0</span>,
                <span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">300</span>,<span class="fl">300</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">300</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">300</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1000</span>,<span class="fl">1000</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,
                <span class="fl">1000</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1000</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>

<span class="va">dt</span><span class="op">[</span>, <span class="va">MainEngineLoad_kW</span> <span class="op">:=</span> <span class="va">mainLoad</span><span class="op">]</span>
<span class="va">dt</span><span class="op">[</span>, <span class="va">AuxEngineLoad_kW</span> <span class="op">:=</span> <span class="va">auxLoad</span><span class="op">]</span>
<span class="va">dt</span><span class="op">[</span>, <span class="va">BoilerEngineLoad_kW</span> <span class="op">:=</span> <span class="va">boilerLoad</span><span class="op">]</span>

<span class="va">dt</span><span class="op">[</span>, <span class="va">loadFactor</span> <span class="op">:=</span> <span class="va">MainEngineLoad_kW</span><span class="op">/</span><span class="va">Propulsive_Power</span><span class="op">]</span></code></pre></div>
</div>
<div id="assigning-emission-factors" class="section level3">
<h3 class="hasAnchor">
<a href="#assigning-emission-factors" class="anchor"></a>Assigning Emission Factors</h3>
<p>Now that we’ve assigned engine loads, we can assign emission factors. This package has an option to calculate base emission factors and low load adjustment factors separately, but the most typical use case will be to calculate emission factors which could be directly applied to the vessel activity, so this vignette will demonstrate how to calculate the emission factors with the low load adjustment factors already applied.</p>
<p>Since there are separate emission factors for main, auxiliary, and boiler engines, it can be useful to separate these into 3 different data tables. In practice, these data tables can become very large, so only the columns necessary for calculating the emission factors and the final emission quantities need to be retained.</p>
<p>For calculating main engine emission factors, we need the main engine type and engine tier for selecting the correct emission factors, location to specify the fuel sulfur content, and load factor for calculating the low load adjustment factors. We need the main engine load and time between messages to calculate the emission quantities. It is also helpful to retain the vessel ID.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">main</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">VesselID</span>, <span class="va">mainEngineType</span>, <span class="va">tier</span>, <span class="va">ECA</span>, <span class="va">loadFactor</span>, <span class="va">MainEngineLoad_kW</span>, <span class="va">TimeBtwnMsgs_hr</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Next, for calculating the auxiliary engine emission factors, we need the auxiliary engine type, tier, and location, but not load factor. Like for the main engine data table, we will also retain the auxiliary engine load, time between messages, and vessel ID.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aux</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">VesselID</span>, <span class="va">auxEngineType</span>, <span class="va">tier</span>, <span class="va">ECA</span>, <span class="va">AuxEngineLoad_kW</span>, <span class="va">TimeBtwnMsgs_hr</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Finally, for calculating the boiler engine emission factors, we need the boiler engine type and location, and we will also retain the boiler engine load, time between messages, and vessel ID.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boiler</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">VesselID</span>, <span class="va">boilerEngineType</span>, <span class="va">ECA</span>, <span class="va">BoilerEngineLoad_kW</span>, <span class="va">TimeBtwnMsgs_hr</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Now that we have our three separate data tables ready, we can begin to calculate the emission factors.</p>
<p>Emission factors (g/kWh) can be assigned independently for each pollutant through the following functions:</p>
<ul>
<li><code>calcEF_CO</code></li>
<li><code>calcEF_CO2</code></li>
<li><code>calcEF_HC</code></li>
<li><code>calcEF_NOx</code></li>
<li><code>calcEF_PM</code></li>
<li><code>calcEF_SO2</code></li>
</ul>
<p>However, when using these functions individually, <code>calcLLAF</code> needs to be used to calculate the low load adjustment factors. To simplify the process, <code>calcEF</code> acts as a wrapper function for the individual pollutants with the low load adjustment factors already applied.</p>
<p><code>calcEF</code> returns columns of emission factors (one column for each pollutant). In the code below, <code>cbind</code> is used to bind the columns together to form a table.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">main</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">main</span>, <span class="fu"><a href="../reference/calcEF.html">calcEF</a></span><span class="op">(</span>engineType <span class="op">=</span> <span class="va">main</span><span class="op">$</span><span class="va">mainEngineType</span>,
                           tier <span class="op">=</span> <span class="va">main</span><span class="op">$</span><span class="va">tier</span>,
                           location <span class="op">=</span> <span class="va">main</span><span class="op">$</span><span class="va">ECA</span>,
                           loadFactor <span class="op">=</span> <span class="va">main</span><span class="op">$</span><span class="va">loadFactor</span>,
                           pollutants <span class="op">=</span> <span class="st">"ALL"</span>,
                           main_aux_boiler <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span><span class="op">)</span>

<span class="va">aux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">aux</span>, <span class="fu"><a href="../reference/calcEF.html">calcEF</a></span><span class="op">(</span>engineType <span class="op">=</span> <span class="va">aux</span><span class="op">$</span><span class="va">auxEngineType</span>,
                         tier <span class="op">=</span> <span class="va">aux</span><span class="op">$</span><span class="va">tier</span>,
                         location <span class="op">=</span> <span class="va">aux</span><span class="op">$</span><span class="va">ECA</span>,
                         pollutants <span class="op">=</span> <span class="st">"ALL"</span>,
                         main_aux_boiler <span class="op">=</span> <span class="st">"aux"</span><span class="op">)</span><span class="op">)</span>

<span class="va">boiler</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">boiler</span>, <span class="fu"><a href="../reference/calcEF.html">calcEF</a></span><span class="op">(</span>engineType <span class="op">=</span> <span class="va">boiler</span><span class="op">$</span><span class="va">boilerEngineType</span>,
                               tier <span class="op">=</span> <span class="cn">NULL</span>,
                               location <span class="op">=</span> <span class="va">boiler</span><span class="op">$</span><span class="va">ECA</span>,
                               pollutants <span class="op">=</span> <span class="st">"ALL"</span>,
                               main_aux_boiler <span class="op">=</span> <span class="st">"boiler"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that if engine-specific load adjustment factors are available for vessels with known engine data, they may be used by supplying the <code>inputTableLocation</code> argument to <code>calcEF</code>. For more information on how to do this, see <code><a href="../reference/calcEF.html">?calcEF</a></code>.</p>
</div>
<div id="calculating-emissions-quantity" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-emissions-quantity" class="anchor"></a>Calculating Emissions Quantity</h3>
<p>Calculating emissions quantity is a simple multiplication by this point. We identify the pollutant columns as <code>efCols</code>. Then, we use a for loop to calculate the emission quantity for each pollutant in the main, auxiliary, and boiler data tables.</p>
<p>The columns specified in <code>efCols</code> contain the emission factors in g/kWh. The emissions quantity is calculated by multiplying the emission factor by the engine load (kW) and the time interval between messages (hr), which results in grams of emissions for that specific time interval.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">efCols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pm2.5"</span>,<span class="st">"pm10"</span>,<span class="st">"so2"</span>,<span class="st">"co2"</span>,<span class="st">"co"</span>,<span class="st">"hc"</span>,<span class="st">"nox"</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">efCol</span> <span class="kw">in</span> <span class="va">efCols</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">quantColName</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">efCol</span>, <span class="st">"Quant"</span>, sep<span class="op">=</span><span class="st">''</span><span class="op">)</span>
  <span class="va">main</span><span class="op">[</span>, <span class="op">(</span><span class="va">quantColName</span><span class="op">)</span> <span class="op">:=</span> <span class="va">main</span><span class="op">[[</span><span class="va">efCol</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">MainEngineLoad_kW</span> <span class="op">*</span> <span class="va">TimeBtwnMsgs_hr</span><span class="op">]</span>
  <span class="va">aux</span><span class="op">[</span>, <span class="op">(</span><span class="va">quantColName</span><span class="op">)</span> <span class="op">:=</span> <span class="va">aux</span><span class="op">[[</span><span class="va">efCol</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">AuxEngineLoad_kW</span> <span class="op">*</span> <span class="va">TimeBtwnMsgs_hr</span><span class="op">]</span>
  <span class="va">boiler</span><span class="op">[</span>, <span class="op">(</span><span class="va">quantColName</span><span class="op">)</span> <span class="op">:=</span> <span class="va">boiler</span><span class="op">[[</span><span class="va">efCol</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">BoilerEngineLoad_kW</span> <span class="op">*</span> <span class="va">TimeBtwnMsgs_hr</span><span class="op">]</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>U.S. Environmental Protection Agency. 2020. “Port Emissions Inventory Guidance: Methodologies for Estimating Port-Related and Goods Movement Mobile Source Emissions.” EPA-420-B-20-046. <a href="https://nepis.epa.gov/Exe/ZyPDF.cgi?Dockey=P100AU0I.PDF" class="uri">https://nepis.epa.gov/Exe/ZyPDF.cgi?Dockey=P100AU0I.PDF</a></p>
<p>U.S. Environmental Protection Agency. 2010. “Designation of North American Emission Control Area to Reduce Emissions from Ships.” EPA-420-F-10-015. <a href="https://nepis.epa.gov/Exe/ZyPDF.cgi?Dockey=P100AU0I.PDF" class="uri">https://nepis.epa.gov/Exe/ZyPDF.cgi?Dockey=P100AU0I.PDF</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Isabela Brown, Michael Aldridge, Daniel Bizer-Cox.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
